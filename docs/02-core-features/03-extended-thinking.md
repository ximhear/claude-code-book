<!-- last_updated: 2026-02-11 -->

# 7. 확장된 사고 (Extended Thinking)

> Claude의 심층 추론 기능인 Extended Thinking의 작동 원리와 효과적인 활용법을 다룹니다.

---

## Extended Thinking이란

**Extended Thinking**은 Claude가 최종 답변을 생성하기 전에 내부적으로 단계별 추론을 수행하는 기능입니다. 복잡한 문제에서 Claude가 더 깊이 생각하고, 여러 접근 방식을 탐색하고, 스스로 오류를 수정할 수 있게 합니다.

```
일반 모드:
  사용자 요청 → Claude 응답

Extended Thinking 모드:
  사용자 요청 → [내부 추론] → Claude 응답
                  ↑
                  생각 과정을 단계별로 전개
                  여러 접근 방식 비교
                  엣지 케이스 고려
                  자체 검증
```

Extended Thinking을 활성화하면 Claude는 `thinking` 블록에서 추론한 후 `text` 블록으로 최종 응답을 제공합니다.

---

## 적응형 추론 (Adaptive Reasoning)

### Opus 4.6의 차별점

Claude Opus 4.6은 **적응형 추론 (Adaptive Reasoning)**을 사용합니다. 이전 모델의 고정 예산(budget_tokens) 방식과 달리, 작업 복잡도에 따라 사고 깊이를 **자동으로 조절**합니다.

| 방식 | 모델 | 작동 방식 |
|------|------|-----------|
| **적응형** (Adaptive) | Opus 4.6 | 노력 수준(effort level)으로 제어. 토큰 예산 자동 할당 |
| **수동** (Manual) | Sonnet 4.6, Haiku 4.5 | budget_tokens를 명시적으로 지정 |

적응형 추론의 장점:
- 간단한 질문에는 짧게 생각하고, 복잡한 문제에는 깊이 생각합니다
- 토큰 예산을 수동으로 관리할 필요가 없습니다
- 불필요한 사고에 토큰을 낭비하지 않습니다

---

## 노력 수준 (Effort Level)

Opus 4.6에서 사고의 깊이를 제어하는 세 가지 수준입니다.

### Low — 빠른 응답

```
최소한의 추론. 단순한 작업에 적합.
```

- 직관적인 답변 위주
- 간단한 파일 수정, 명확한 질문에 사용
- 토큰 사용량이 가장 적음

### Medium — 균형잡힌 추론

```
적절한 깊이의 추론. 대부분의 작업에 적합.
```

- 기본적인 분석과 비교를 수행
- 일반적인 코딩 작업, 버그 수정에 적합
- 비용과 품질의 균형

### High — 심층 추론 (기본값)

```
최대 깊이의 추론. 복잡한 문제에 적합.
```

- 여러 접근 방식을 탐색하고 비교
- 엣지 케이스와 트레이드오프를 분석
- 아키텍처 결정, 복잡한 디버깅에 최적
- 토큰 사용량이 가장 많음

### 노력 수준 설정 방법

**방법 1: `/model` 커맨드에서 조절**

```
> /model
```

Opus 4.6을 선택한 후 **좌/우 화살표 키**로 노력 수준을 조절합니다.

**방법 2: 환경 변수**

```bash
export CLAUDE_CODE_EFFORT_LEVEL=low     # 또는 medium, high
```

**방법 3: API 파라미터** (프로그래밍 방식)

```json
{
  "thinking": { "type": "adaptive" },
  "effort": { "type": "high" }
}
```

---

## Thinking 모드 토글

### Option+T / Alt+T — 키보드 토글

세션 중 Extended Thinking을 켜거나 끕니다:

| 플랫폼 | 단축키 |
|--------|--------|
| **macOS** | Option+T |
| **Windows/Linux** | Alt+T |

> **요구사항**: `/terminal-setup`을 먼저 실행해야 합니다. macOS에서는 터미널의 Option 키를 Meta로 설정해야 합니다 (iTerm2: Profiles → Keys → "Esc+" 선택).

### `/config` — 전역 설정

```
> /config
```

설정 화면에서 Extended Thinking을 전역으로 활성화/비활성화합니다. `~/.claude/settings.json`의 `alwaysThinkingEnabled` 값으로 저장됩니다.

### 환경 변수

```bash
# Thinking 토큰 예산 설정 (기본: 31,999)
export MAX_THINKING_TOKENS=10000

# Thinking 완전 비활성화
export MAX_THINKING_TOKENS=0
```

> **참고**: Opus 4.6의 적응형 추론에서는 `MAX_THINKING_TOKENS`가 무시됩니다 (0으로 설정하여 비활성화하는 경우 제외). Sonnet/Haiku에서는 이 값이 사고 토큰 예산으로 작용합니다.

---

## Verbose 모드: 사고 과정 보기

### Ctrl+O — Verbose 토글

세션 중 `Ctrl+O`를 누르면 Claude의 사고 과정을 볼 수 있습니다.

```
[Verbose 모드 ON]

Claude의 사고 과정 (회색 이탤릭):
  이 문제를 분석해보겠습니다. 먼저 세션 토큰의 만료 로직을
  확인해야 합니다. refreshToken 함수가 호출되는 시점이...

Claude의 응답:
  세션 만료 문제는 refreshToken 함수에서 발생합니다...
```

- Verbose 모드에서는 요약된 사고 과정이 **회색 이탤릭** 텍스트로 표시됩니다
- Opus 4.6과 Sonnet 4.6은 **요약된** 사고를 보여줍니다 (전체가 아님)
- 토글로 켜고 끌 수 있습니다

### 사고 블록의 종류

Claude의 응답에는 세 가지 유형의 블록이 포함될 수 있습니다:

| 블록 타입 | 설명 |
|-----------|------|
| `thinking` | 일반적인 사고 과정 (요약본이 표시됨) |
| `redacted_thinking` | 안전 시스템에 의해 암호화된 사고 (Claude는 계속 사용 가능) |
| `text` | 최종 응답 |

`redacted_thinking`은 안전 시스템이 내부 추론의 일부를 암호화한 것입니다. 이는 정상적인 동작이며, Claude의 응답 품질에는 영향을 주지 않습니다.

---

## 토큰 예산과 비용

### 기본 토큰 예산

| 설정 | 값 |
|------|-----|
| **기본 사고 토큰 예산** | 31,999 토큰 |
| **최소 예산** | 1,024 토큰 |
| **환경 변수** | `MAX_THINKING_TOKENS` |

### 비용 구조

Extended Thinking의 비용을 이해하는 것이 중요합니다:

```
입력 토큰:  일반 요금으로 과금
사고 토큰:  출력 토큰 요금으로 과금 (전체 사고 토큰 기준)
출력 토큰:  일반 요금으로 과금
```

**중요**: 사용자에게 보이는 것은 **요약된** 사고 블록이지만, **과금은 원래 전체 사고 토큰**에 대해 이루어집니다.

```
예시:
  Claude가 내부적으로 5,000 토큰의 사고를 수행
  사용자에게는 500 토큰의 요약이 표시됨
  과금은 5,000 토큰에 대해 이루어짐 (요약의 500 토큰이 아님)
```

### 모델별 비용 비교

| 모델 | 사고 토큰 요금 (출력 기준) | 일반 사용 시 비용 | Thinking 사용 시 추가 비용 |
|------|:------------------------:|:-----------------:|:------------------------:|
| **Opus 4.6** | $25 / 1M 토큰 | 기본 | 사고 깊이에 비례 |
| **Sonnet 4.6** | $15 / 1M 토큰 | 기본 | budget_tokens에 비례 |
| **Haiku 4.5** | $5 / 1M 토큰 | 기본 | budget_tokens에 비례 |

### 비용 최적화 전략

1. **노력 수준 활용** (Opus 4.6): 간단한 작업에는 `low`를 사용하여 불필요한 사고 토큰을 절약
2. **작은 예산부터 시작** (Sonnet/Haiku): `budget_tokens=1024`에서 시작하여 점진적으로 늘리기
3. **선택적 활성화**: 복잡한 작업에만 Thinking을 켜고 루틴 작업에서는 끄기
4. **`/cost`로 모니터링**: 세션 중 토큰 사용량을 주기적으로 확인
5. **Opusplan 활용**: 계획 단계에서만 Opus의 깊은 사고를 사용하고, 실행은 Sonnet으로

---

## Thinking이 효과적인 상황

### 사용을 권장하는 경우

| 상황 | 이유 |
|------|------|
| **복잡한 아키텍처 결정** | 여러 선택지의 트레이드오프를 체계적으로 분석 |
| **어려운 버그 디버깅** | 여러 가설을 세우고 검증하는 과정이 필요 |
| **멀티스텝 구현 계획** | 전체 계획을 머릿속에서 시뮬레이션 |
| **보안 분석** | 취약점을 체계적으로 탐색 |
| **코드 리뷰** | 엣지 케이스와 잠재적 문제를 깊이 분석 |
| **수학/알고리즘 문제** | 단계별 추론이 정확도를 크게 향상 |
| **리팩토링 전략** | 영향 범위와 안전한 변환 순서를 분석 |

### 사용이 불필요한 경우

| 상황 | 이유 |
|------|------|
| **단순 파일 읽기** | 읽기 자체에 추론이 불필요 |
| **직관적인 코드 수정** | 타입 추가, 변수명 변경 등 |
| **테스트 실행** | 명령어 실행에 깊은 사고 불필요 |
| **문서 참조 질문** | 검색으로 해결 가능한 단순 질문 |
| **반복적인 작업** | 패턴이 명확한 반복 수정 |

### 실전 예시

```
# Thinking이 도움되는 프롬프트 (✅)
> 이 결제 시스템의 동시성 문제를 분석하고,
> 레이스 컨디션을 방지하는 방법을 제안해줘.

# Thinking 없이도 충분한 프롬프트 (✅ — 단순 작업)
> utils.ts에서 formatDate 함수의 반환 타입을 string으로 변경해줘.
```

---

## 모델별 Thinking 동작 차이

| 특성 | Opus 4.6 | Sonnet 4.6 | Haiku 4.5 |
|------|:--------:|:----------:|:---------:|
| **추론 방식** | 적응형 (effort level) | 수동 (budget_tokens) | 수동 (budget_tokens) |
| **출력** | 요약된 사고 | 요약된 사고 | 요약된 사고 |
| **인터리브드 사고** | 자동 지원 | 베타 헤더 필요 | 베타 헤더 필요 |
| **사고 블록 보존** | 턴 간 자동 보존 | 턴 간 보존 안 됨 | 턴 간 보존 안 됨 |
| **캐시 최적화** | 보존된 사고로 캐시 히트 | 해당 없음 | 해당 없음 |

**인터리브드 사고 (Interleaved Thinking)**: Claude가 도구 호출 사이사이에 사고 블록을 삽입하는 기능입니다. 한국어로 "교차 사고" 또는 "인터리브드 사고"라고 부릅니다. Opus 4.6에서는 자동으로 지원됩니다.

**사고 블록 보존**: Opus 4.6에서는 이전 턴의 사고 블록이 컨텍스트에 유지됩니다. 이를 통해:
- 도구 사용 시 캐시 히트율이 높아져 토큰 비용 절감
- 긴 대화에서 컨텍스트를 더 많이 사용 (주의 필요)

---

## 설정 빠른 참조

| 목적 | 방법 |
|------|------|
| **세션 중 토글** | `Option+T` (Mac) / `Alt+T` |
| **전역 활성화** | `/config` → Extended Thinking 설정 |
| **노력 수준 조절** | `/model` → Opus 선택 → 좌/우 화살표 |
| **노력 수준 고정** | `CLAUDE_CODE_EFFORT_LEVEL=high` |
| **토큰 예산 제한** | `MAX_THINKING_TOKENS=10000` |
| **완전 비활성화** | `MAX_THINKING_TOKENS=0` |
| **사고 과정 보기** | `Ctrl+O` (Verbose 모드) |

---

## 요약

| 주제 | 핵심 포인트 |
|------|------------|
| **개념** | Claude가 답변 전에 내부적으로 단계별 추론을 수행 |
| **적응형 추론** | Opus 4.6은 작업 복잡도에 따라 사고 깊이를 자동 조절 |
| **노력 수준** | Low (빠른), Medium (균형), High (심층, 기본값) |
| **토글** | Option+T, `/config`, `MAX_THINKING_TOKENS` |
| **비용** | 전체 사고 토큰에 대해 과금 (요약본이 아님) |
| **활용** | 복잡한 문제에서 효과적, 단순 작업에서는 불필요 |
| **모델 차이** | Opus 4.6 (적응형, 자동 보존) vs Sonnet/Haiku (수동 예산) |

---

## 다음 챕터

[8장: 모델 선택과 전환](04-model-selection.md)에서 상황에 맞는 모델 선택 전략과 전환 방법을 배웁니다.
