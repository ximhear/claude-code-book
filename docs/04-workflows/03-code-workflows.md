<!-- last_updated: 2026-02-11 -->

# 16. 코드 탐색, 디버깅, 리팩토링

> 일상적인 코딩 작업에서의 Claude Code 활용 패턴을 다룹니다.

---

## 새로운 코드베이스 이해하기

### 프로젝트 개요 파악

새로운 프로젝트에 투입되었을 때, Claude에게 전체 구조를 물어보세요:

```
> 이 프로젝트의 전체 구조를 설명해줘
> 주요 기술 스택과 아키텍처 패턴이 뭐야?
> 데이터가 어떻게 흐르는지 설명해줘
```

Claude는 파일 구조, 설정 파일, 의존성을 분석하여 프로젝트의 전체 그림을 제공합니다.

### 특정 모듈 분석

```
> src/auth/ 디렉토리의 인증 흐름을 설명해줘
> 결제 모듈이 외부 API와 어떻게 통신하는지 알려줘
> 이 미들웨어 체인이 어떤 순서로 실행되는지 추적해줘
```

### 온보딩 워크플로우

Plan 모드와 결합하면 코드를 변경하지 않고 안전하게 탐색할 수 있습니다:

```
(Plan 모드)
> 이 프로젝트의 빌드 과정을 설명해줘
> 테스트는 어떻게 구성되어 있어?
> 환경 변수로 무엇을 설정해야 해?
```

---

## 코드 검색 패턴

### 정의 찾기

```
> UserService 클래스가 어디에 정의되어 있어?
> handlePayment 함수를 찾아줘
> AuthContext가 사용되는 모든 곳을 보여줘
```

Claude는 Glob과 Grep 도구를 활용하여 코드를 검색합니다.

### 사용처 추적

```
> updatePermissions() 함수를 호출하는 모든 곳을 찾아줘
> UserRole 타입을 사용하는 파일 목록을 보여줘
> 이 API 엔드포인트를 호출하는 클라이언트 코드는 어디에 있어?
```

### 패턴 검색

```
> console.log가 남아있는 파일을 모두 찾아줘
> TODO 주석이 있는 곳을 보여줘
> 하드코딩된 URL이 있는지 확인해줘
```

---

## 버그 추적과 수정

### 에러 분석

에러 메시지나 로그를 Claude에게 보여주세요:

```
> 이 에러를 분석해줘:
> TypeError: Cannot read property 'id' of undefined
>   at UserService.getProfile (src/services/user.ts:45)
>   at async handler (src/routes/user.ts:23)
```

Claude는 스택 트레이스를 따라 관련 파일을 읽고 원인을 분석합니다.

### 재현과 수정

```
> 이 버그의 원인을 찾고 수정해줘
> 수정 후 관련 테스트도 추가해줘
```

Claude의 디버깅 과정:

1. 에러가 발생하는 코드 읽기
2. 호출 경로 역추적
3. 관련 데이터 흐름 분석
4. 근본 원인 파악
5. 수정 구현
6. 테스트로 검증

### 로그 기반 디버깅

```bash
# 로그 파일을 Claude에게 전달
cat error.log | claude -p "이 에러의 원인을 분석해줘"
```

```
> 프로덕션 로그에서 이 패턴의 에러가 반복되고 있어.
> 원인을 찾고 해결책을 제안해줘.
```

---

## 리팩토링 워크플로우

### 함수 추출

```
> 이 함수가 너무 길어. 적절히 분리해줘.
> 중복된 로직을 공통 함수로 추출해줘.
```

### 타입 개선

```
> 이 파일의 any 타입을 적절한 타입으로 바꿔줘
> 이 인터페이스에 누락된 필드를 추가해줘
```

### 대규모 리팩토링

대규모 리팩토링은 Plan 모드로 시작하세요:

```
# Plan 모드
> 이 모듈을 리팩토링하려면 어떤 접근이 좋을까?
> 영향받는 파일 목록과 순서를 제안해줘

# 구현 모드
> 계획대로 첫 번째 단계부터 진행해줘
> 각 단계마다 테스트가 통과하는지 확인해줘
```

### 안전한 리팩토링 원칙

Claude는 다음 원칙을 따릅니다:

- 동작을 변경하지 않는 리팩토링 우선
- 한 번에 한 가지 변경만 수행
- 각 단계마다 테스트 실행 가능
- 체크포인트를 활용하여 되돌리기 가능

---

## 테스트 작성과 실행

### 테스트 생성

```
> 이 함수에 대한 단위 테스트를 작성해줘
> 에지 케이스도 포함해줘
> 현재 프로젝트의 테스트 패턴을 따라서 작성해줘
```

Claude는 기존 테스트 파일을 참고하여 프로젝트의 테스트 스타일에 맞게 작성합니다.

### 테스트 실행

```
> 이 테스트 파일을 실행해줘
> 실패하는 테스트가 있으면 수정해줘
```

### 테스트 커버리지

```
> 이 모듈의 테스트 커버리지를 확인해줘
> 커버리지가 낮은 부분에 테스트를 추가해줘
```

### TDD 워크플로우

```
> 먼저 이 기능의 테스트를 작성해줘
> (테스트 확인 후)
> 이 테스트를 통과하는 구현을 작성해줘
```

---

## 코드 리뷰

### 변경 사항 리뷰

```
> 최근 변경 사항을 리뷰해줘
> 보안 취약점이 있는지 확인해줘
> 성능 문제가 될 수 있는 부분을 찾아줘
```

### 리뷰 관점 지정

```
> OWASP Top 10 기준으로 이 코드를 검토해줘
> 동시성 문제가 있는지 확인해줘
> 에러 핸들링이 충분한지 확인해줘
```

### PR 리뷰

```bash
# PR 컨텍스트를 로드하여 리뷰
claude --from-pr 789
> 이 PR을 리뷰해줘. 특히 데이터베이스 쿼리 변경에 주의해줘.
```

---

## 문서화

### 코드 주석

```
> 이 복잡한 알고리즘에 주석을 추가해줘
> 공개 API 함수에 JSDoc을 추가해줘
```

### README 작성

```
> 이 프로젝트의 README.md를 작성해줘
> 설치 방법, 사용법, API 문서를 포함해줘
```

### API 문서

```
> 이 REST API의 엔드포인트 문서를 작성해줘
> OpenAPI 스펙으로 만들어줘
```

---

## 효과적인 프롬프트 패턴

### 구체적인 요청

```
# 좋은 요청 (✅)
> src/services/payment.ts의 processPayment 함수에서
> Stripe API 호출이 실패할 때 재시도 로직을 추가해줘.
> 최대 3번까지, 지수 백오프로.

# 모호한 요청 (❌)
> 결제 처리를 개선해줘
```

### 컨텍스트 제공

```
# 좋은 요청 (✅)
> 이 에러가 사용자가 비밀번호를 변경한 직후에만 발생해.
> JWT 토큰 갱신과 관련이 있을 것 같아.

# 컨텍스트 없는 요청 (❌)
> 로그인이 안 돼. 고쳐줘.
```

### 단계적 접근

```
# 좋은 접근 (✅)
> 먼저 현재 인증 흐름을 분석해줘
> (분석 결과 확인 후)
> OAuth 추가 시 변경해야 할 파일을 알려줘
> (계획 확인 후)
> 첫 번째 파일부터 수정해줘

# 한 번에 모든 것 요청 (❌)
> OAuth를 추가하고 테스트하고 배포해줘
```

---

## 요약

| 워크플로우 | 핵심 패턴 |
|-----------|----------|
| **코드 탐색** | Plan 모드로 안전하게 분석, 모듈별 질문 |
| **버그 추적** | 에러 메시지 → 스택 트레이스 추적 → 근본 원인 |
| **리팩토링** | Plan 모드로 계획 → 단계별 구현 → 테스트 검증 |
| **테스트** | 기존 패턴 참고, 에지 케이스 포함, TDD 가능 |
| **코드 리뷰** | 보안/성능/품질 관점 지정, PR 리뷰 |
| **문서화** | JSDoc, README, API 스펙 생성 |
| **프롬프트** | 구체적, 컨텍스트 포함, 단계적 접근 |

---

## 다음 챕터

[17장: 세션 관리와 이어서 작업하기](04-session-management.md)에서 세션 저장, 재개, 포크 등 세션 관리 전략을 배웁니다.
