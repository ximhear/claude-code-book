<!-- last_updated: 2026-02-11 -->

# 15. Plan 모드와 복잡한 작업

> Plan 모드를 활용한 체계적인 작업 진행 방법을 다룹니다.

---

## Plan 모드란?

Plan 모드는 Claude Code의 **읽기 전용 분석 모드**입니다. 파일을 수정하거나 명령어를 실행하지 않고, 오직 코드를 읽고 분석하는 데 집중합니다.

### 사용 가능한 도구

| 도구 | Plan 모드 | 설명 |
|------|:---------:|------|
| Read | O | 파일 읽기 |
| Grep | O | 코드 검색 |
| Glob | O | 파일 패턴 검색 |
| WebFetch | O | 웹 문서 참조 |
| `git status`, `git log` | O | 안전한 Git 명령어 |
| Edit / Write | X | 파일 수정 |
| Bash (일반) | X | 명령어 실행 |
| 브랜치/커밋 생성 | X | Git 변경 작업 |

Plan 모드에서는 **코드베이스에 어떤 변경도 가하지 않습니다**.

---

## 진입과 전환

### 방법 1: Shift+Tab (세션 중)

```
Shift+Tab을 누르면 모드가 순환합니다:
Default Mode → Auto-Accept Mode → Plan Mode → ...
```

터미널에 모드 표시가 나타납니다:
- Default Mode: 일반 프롬프트
- Auto-Accept Mode: `⏵⏵ accept edits on`
- Plan Mode: `⏸ plan mode on`

### 방법 2: CLI 플래그 (세션 시작 시)

```bash
claude --permission-mode plan
```

### 방법 3: 설정 파일

```json
{
  "defaultMode": "plan"
}
```

### 방법 4: Headless 모드

```bash
claude --permission-mode plan -p "인증 시스템 구조를 분석해줘"
```

### Plan 모드 해제

`Shift+Tab`을 다시 눌러 Default 또는 Auto-Accept 모드로 전환합니다.

---

## 4단계 워크플로우

Plan 모드의 진정한 가치는 **탐색 → 계획 → 구현 → 커밋**의 체계적인 흐름에 있습니다.

### 1단계: 탐색 (Plan 모드)

```
⏸ plan mode on

> src/auth/ 디렉토리를 읽고 세션 처리 방식을 설명해줘
> 환경 변수로 어떤 비밀값들을 관리하고 있는지 확인해줘
```

Claude는 파일을 읽고 구조를 분석하지만, 아무것도 변경하지 않습니다.

### 2단계: 계획 (Plan 모드 유지)

```
> Google OAuth를 추가하려면 어떤 파일을 수정해야 해?
> 구현 계획을 상세하게 만들어줘
```

Claude는 상세한 구현 계획을 제시합니다. 이 단계에서 요구사항을 확인하고 방향을 조정합니다.

### 3단계: 구현 (Default 또는 Auto-Accept 모드로 전환)

```
(Shift+Tab으로 모드 전환)

> 계획대로 OAuth 흐름을 구현해줘
> 콜백 핸들러에 대한 테스트도 작성해줘
```

이제 Claude가 실제 파일을 수정하고 명령어를 실행합니다.

### 4단계: 커밋

```
> 변경 사항을 커밋하고 PR을 만들어줘
```

---

## Plan 모드 vs 다른 모드

| 기능 | Plan 모드 | Default 모드 | Auto-Accept 모드 |
|------|:---------:|:----------:|:---------------:|
| 파일 읽기 | O | O | O |
| 파일 수정 | X | 승인 필요 | 자동 승인 |
| Bash 명령어 | 제한적 | 승인 필요 | 승인 필요 |
| 부작용 | 없음 | 가능 | 가능 |
| 체크포인트 | 해당 없음 | 생성 | 생성 |
| 적합한 용도 | 탐색, 계획 | 안전한 코딩 | 빠른 반복 |

---

## 언제 Plan 모드를 사용할까

### 적합한 경우

- **새로운 코드베이스 탐색**: 구조와 패턴을 파악할 때
- **복잡한 리팩토링 계획**: 여러 파일에 걸친 변경을 사전에 설계
- **아키텍처 의사 결정**: 어떤 접근법이 최선인지 분석
- **요구사항 정리**: 구현 전 범위와 영향도 확인
- **코드 리뷰**: 변경 없이 코드를 분석할 때

### 건너뛰어도 되는 경우

- 단순한 수정 (오타, 변수 이름 변경)
- 한 문장으로 설명할 수 있는 명확한 변경
- 시간이 촉박하고 접근법이 확실한 경우

---

## Plan 모드의 비용 절감

Plan 모드에서는 도구 실행이 제한되므로 **도구 호출에 의한 추가 토큰 소비가 줄어듭니다**. 특히:

- 실패한 편집 → 재시도의 반복이 없음
- 잘못된 접근으로 코드를 수정한 후 되돌리는 비용 절약
- 탐색 단계에서 불필요한 명령어 실행 방지

계획 없이 바로 구현에 뛰어드는 것보다, Plan 모드로 방향을 잡은 후 구현하는 것이 전체적으로 더 적은 토큰을 사용하는 경우가 많습니다.

---

## Explore / Plan 서브에이전트

> **혼동 주의**: "Plan 모드"와 "Plan 에이전트"는 다른 개념입니다.
> - **Plan 모드**: 현재 세션의 권한을 읽기 전용으로 제한하는 **권한 모드** (Shift+Tab으로 전환)
> - **Plan 에이전트**: 별도 컨텍스트에서 실행되는 독립적인 **서브에이전트** (Task 도구로 호출)
>
> Plan 모드는 "내가 직접 읽기만 하겠다"이고, Plan 에이전트는 "별도 AI에게 분석을 맡기겠다"입니다.

Claude Code는 전문화된 서브에이전트를 제공합니다.

### Explore 에이전트

읽기 전용 환경에서 코드베이스를 탐색하는 전문 에이전트입니다:

- 파일 수정 도구를 제외한 모든 도구 사용 가능
- 독립적인 컨텍스트 윈도우에서 실행
- 조사 결과를 요약하여 메인 세션에 반환
- 메인 세션의 컨텍스트를 오염시키지 않음

```
> 서브에이전트를 사용해서 인증 모듈이 토큰 갱신을 어떻게 처리하는지 조사해줘
```

### Plan 에이전트

계획과 분석에 특화된 에이전트입니다:

- 파일을 읽고 상세한 구현 계획 작성
- 명확하지 않은 점에 대해 질문
- 구조화된 계획 문서를 반환

### 스킬에서 에이전트 활용

```yaml
---
name: deep-research
description: "코드베이스를 심층 분석합니다"
context: fork
agent: Explore
---

$ARGUMENTS를 심층 분석해주세요:

1. Glob과 Grep으로 관련 파일 찾기
2. 코드를 읽고 분석
3. 구체적인 파일 참조와 함께 결과 요약
```

사용:

```
> /deep-research 인증 시스템의 작동 원리
```

---

## 복잡한 리팩토링 사례

### 상태 관리 마이그레이션

```
# 1단계: 탐색 (Plan 모드)
> Redux를 사용하는 모든 컴포넌트를 찾아줘
> 각 스토어의 상태 구조를 분석해줘
> Zustand로 마이그레이션할 경우 영향 범위를 알려줘

# 2단계: 계획 (Plan 모드 유지)
> 마이그레이션 순서와 각 단계의 구현 계획을 만들어줘
> 점진적으로 마이그레이션할 수 있는 방법을 제안해줘

# 3단계: 구현 (모드 전환)
> 첫 번째 스토어부터 Zustand로 마이그레이션해줘
> 테스트가 통과하는지 확인해줘

# 4단계: 반복
> 다음 스토어로 진행해줘
```

### 데이터베이스 스키마 변경

```
# Plan 모드로 영향 분석
> users 테이블에 role 컬럼을 추가하면 영향받는 쿼리를 모두 찾아줘
> 마이그레이션 전략을 제안해줘

# 구현 모드로 전환
> 마이그레이션을 생성하고 관련 코드를 수정해줘
```

---

## 요약

| 주제 | 핵심 포인트 |
|------|------------|
| **Plan 모드** | 읽기 전용 분석 모드, 코드 변경 불가 |
| **진입 방법** | Shift+Tab, `--permission-mode plan`, 설정 파일 |
| **4단계 흐름** | 탐색 → 계획 → 구현 → 커밋 |
| **비용 절감** | 잘못된 접근의 시행착오 비용 절약 |
| **서브에이전트** | Explore (탐색 전문), Plan (계획 전문) |
| **적합한 경우** | 새 코드베이스, 복잡한 리팩토링, 아키텍처 결정 |
| **모드 표시** | `⏸ plan mode on` |

---

## 다음 챕터

[16장: 코드 탐색, 디버깅, 리팩토링](03-code-workflows.md)에서 일상적인 코딩 작업에서의 Claude Code 활용 패턴을 배웁니다.
