<!-- last_updated: 2026-02-11 -->

# 30. 실전 워크플로우 패턴

> 실제 개발에서 바로 적용할 수 있는 워크플로우 패턴을 다룹니다.

---

## 탐색 → 계획 → 실행 → 검증 패턴

가장 기본적이고 효과적인 4단계 패턴입니다.

### 1단계: 탐색 (Plan 모드)

```
(Shift+Tab → Plan 모드)
> 이 프로젝트의 인증 시스템을 분석해줘
> 데이터 흐름과 주요 컴포넌트를 설명해줘
```

### 2단계: 계획 (Plan 모드 유지)

```
> OAuth를 추가하려면 어떤 파일을 수정해야 해?
> 단계별 구현 계획을 만들어줘
```

### 3단계: 실행 (Default 모드 전환)

```
(Shift+Tab → Default 모드)
> 계획의 첫 번째 단계를 구현해줘
```

### 4단계: 검증

```
> 테스트를 실행해줘
> 변경 사항을 커밋하고 PR을 만들어줘
```

---

## 대규모 리팩토링 패턴

### 점진적 마이그레이션

```
# 1. 영향 분석 (Plan 모드)
> Redux에서 Zustand로 마이그레이션할 범위를 분석해줘

# 2. 병렬 구현 (새 코드 추가)
> 기존 Redux 스토어를 유지하면서 Zustand 스토어를 추가해줘

# 3. 점진적 전환 (하나씩 교체)
> UserStore부터 Zustand로 전환해줘. 테스트가 통과하면 다음으로.

# 4. 정리 (이전 코드 제거)
> 모든 컴포넌트가 Zustand를 사용하는지 확인하고 Redux를 제거해줘
```

### 안전 장치

- 각 단계 후 테스트 실행
- 체크포인트를 활용하여 문제 시 되돌리기
- 하나의 커밋에 하나의 논리적 변경

---

## 테스트 주도 개발 (TDD) 패턴

```
# 1. 테스트 먼저 작성
> PaymentService의 processPayment 함수에 대한 테스트를 작성해줘
> 성공, 실패, 타임아웃, 재시도 케이스를 포함해줘

# 2. 테스트 확인
> 테스트를 실행해줘 (모두 실패해야 정상)

# 3. 구현
> 이 테스트를 통과하는 최소한의 구현을 작성해줘

# 4. 리팩토링
> 테스트가 통과하는 상태에서 코드를 개선해줘
```

---

## 문서화 워크플로우

### API 문서 생성

```
> src/api/ 디렉토리의 모든 엔드포인트에 대한 API 문서를 생성해줘
> OpenAPI 스펙 형식으로 만들어줘
```

### 코드 주석 추가

```
> 공개 함수에 JSDoc을 추가해줘
> 복잡한 알고리즘에는 설명 주석도 넣어줘
```

### README 업데이트

```
> 이 프로젝트의 README를 최신 상태로 업데이트해줘
> 설치 방법, 사용법, 기여 가이드를 포함해줘
```

---

## 멀티 세션 병렬 개발

### Git Worktree 활용

```bash
# 기능 개발
git worktree add ../project-feature -b feature/dashboard
cd ../project-feature && claude
> /rename feature-dashboard
> 대시보드 기능을 구현해줘

# 동시에 버그 수정
git worktree add ../project-fix -b fix/auth-bug
cd ../project-fix && claude
> /rename fix-auth
> 인증 타임아웃 버그를 수정해줘
```

### 서브에이전트 활용

```
> 서브에이전트를 사용해서 동시에 조사해줘:
> 1. 프론트엔드의 성능 병목 지점
> 2. 백엔드 API의 응답 시간 이슈
> 3. 데이터베이스 쿼리 최적화 기회
```

---

## 코드 리뷰 자동화

### 스킬 기반 리뷰

```markdown
---
name: review
description: "종합 코드 리뷰"
context: fork
agent: code-reviewer
---

$ARGUMENTS에 대한 코드 리뷰:

1. 보안 (OWASP Top 10)
2. 성능 (N+1 쿼리, 불필요한 렌더링)
3. 코드 품질 (중복, 복잡도)
4. 테스트 커버리지
5. 접근성 (a11y)
```

### CI 연동 리뷰

```bash
# PR에 자동 리뷰 코멘트
git diff origin/main | claude -p "종합 리뷰해줘" \
  --max-budget-usd 0.50 \
  > review.md
```

---

## 디버깅 패턴

### 에러 추적

```
> 이 에러 로그를 분석해줘:
> [에러 내용 붙여넣기]
> 스택 트레이스를 따라 근본 원인을 찾아줘
```

### 재현 → 분석 → 수정 → 검증

```
> 이 버그를 재현하는 테스트를 먼저 작성해줘
> (테스트 실패 확인)
> 원인을 분석하고 수정해줘
> (테스트 통과 확인)
> 수정 사항을 커밋해줘
```

---

## 데이터베이스 마이그레이션 패턴

### 안전한 스키마 변경

```
# 1. 현재 스키마 분석 (Plan 모드)
(Shift+Tab → Plan 모드)
> 현재 DB 스키마를 분석하고, users 테이블에 phone 컬럼을 추가할 때
> 영향받는 모델, 쿼리, API 엔드포인트를 모두 파악해줘

# 2. 마이그레이션 파일 생성 (Default 모드)
(Shift+Tab → Default 모드)
> 마이그레이션 파일을 생성해줘
> - 롤백 가능하게 up/down 모두 작성
> - nullable로 추가하여 기존 데이터 영향 없게

# 3. 관련 코드 수정
> 모델, 시리얼라이저, API 엔드포인트를 순서대로 수정해줘
> 각 수정 후 테스트를 실행해줘

# 4. 검증
> 마이그레이션을 실행하고, 롤백했다가 다시 실행해서 안전한지 확인해줘
```

### 주의 사항

- 프로덕션 DB에 직접 접근하는 명령어는 `deny` 규칙으로 차단
- 마이그레이션은 항상 **롤백 가능하게** 작성
- 대용량 테이블 변경 시 다운타임 영향 확인

---

## 요약

| 패턴 | 핵심 |
|------|------|
| **4단계** | 탐색 → 계획 → 실행 → 검증 |
| **리팩토링** | 점진적 마이그레이션, 각 단계 후 테스트 |
| **TDD** | 테스트 → 실패 확인 → 구현 → 리팩토링 |
| **문서화** | API 문서, 코드 주석, README 자동 생성 |
| **병렬 개발** | Worktree + 서브에이전트 |
| **리뷰 자동화** | 스킬 + CI 연동 |
| **디버깅** | 재현 → 분석 → 수정 → 검증 |
| **DB 마이그레이션** | 분석 → 생성 → 수정 → 롤백 검증 |

---

## 다음 챕터

[31장: 비용 최적화 전략](03-cost-optimization.md)에서 토큰 사용량을 줄이고 비용을 최적화하는 방법을 배웁니다.
