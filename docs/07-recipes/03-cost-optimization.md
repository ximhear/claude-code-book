<!-- last_updated: 2026-02-11 -->

# 31. 비용 최적화 전략

> 토큰 사용량을 줄이고 비용을 최적화하는 전략을 다룹니다.

---

## 모델별 비용 비교

### 2026년 2월 기준 가격 (100만 토큰당)

| 모델 | 입력 | 출력 | 특징 |
|------|:----:|:----:|------|
| **Haiku 4.5** | $1 | $5 | 가장 저렴, 대량 처리 |
| **Sonnet 4.5** | $3 | $15 | 균형, 1M 컨텍스트 |
| **Opus 4.6** | $5 | $25 | 최고 성능, 적응형 추론 |

### 월별 예상 비용

> 아래 수치는 프롬프트 캐싱 적용 전 기준이며, 세션당 평균 입력 ~50K + 출력 ~5K 토큰을 가정한 대략적 추정입니다. 실제 비용은 프롬프트 길이, 캐시 적중률, Extended Thinking 사용 여부에 따라 크게 달라집니다.

| 사용 패턴 | Haiku | Sonnet | Opus |
|-----------|:-----:|:------:|:----:|
| 가벼운 사용 (일 5회) | ~$5 | ~$15 | ~$25 |
| 일반 사용 (일 20회) | ~$15 | ~$50 | ~$80 |
| 집중 사용 (일 50회) | ~$40 | ~$120 | ~$200 |

> **팁**: `/cost` 명령어로 현재 세션의 실제 비용을 확인하세요. 프롬프트 캐싱이 활성화되면 위 수치에서 50-90% 절감이 가능합니다.

---

## 프롬프트 캐싱

### 캐싱 비용

프롬프트 캐싱은 TTL (Time-to-Live) 기간에 따라 가격이 다릅니다:

| 토큰 유형 | 가격 (기본 입력 대비) | 설명 |
|-----------|:------------------:|------|
| **캐시 기록** | 1.25x | 최초 캐시 생성 시 (기본 TTL: 5분) |
| **캐시 읽기** | **0.1x** | 캐시 적중 시 (90% 할인) |
| **일반 입력** | 1x | 캐시 미적중 시 |

> **참고**: 캐시 TTL은 기본 5분이며, 마지막 사용 시점부터 다시 카운트됩니다. Claude Code에서는 같은 세션 내 연속 요청에서 CLAUDE.md, 시스템 프롬프트, 이전 대화 이력이 자동으로 캐싱됩니다. 최신 가격은 [Anthropic 공식 요금 페이지](https://docs.anthropic.com/en/docs/about-claude/pricing)를 확인하세요.

### 절감 효과

동일한 CLAUDE.md, 시스템 프롬프트, 대화 이력의 반복 전송에서 캐시 적중 시 **최대 90% 비용 절감**과 85% 지연 시간 개선이 가능합니다.

### 캐싱 최적화 팁

- CLAUDE.md를 안정적으로 유지 (변경이 적을수록 캐시 적중률 높음)
- 세션을 자주 초기화하지 않기 (`/clear`는 캐시를 무효화)
- `--continue`로 기존 세션을 이어가기

---

## 컨텍스트 관리 전략

### CLAUDE.md 최적화

```markdown
# 나쁜 예 — 불필요하게 긴 CLAUDE.md
(10,000자가 넘는 상세한 설명, 예제 코드, 히스토리...)

# 좋은 예 — 핵심만 포함
- 빌드: `npm run build`
- 테스트: `npm test`
- 들여쓰기: 2스페이스
- TypeScript strict
```

### `/compact` 활용

대화가 길어지면 수동으로 압축합니다:

```
> /compact API 변경에 집중해줘
```

### `/clear` 활용

무관한 작업 사이에는 컨텍스트를 초기화합니다:

```
> /clear
# 새로운 작업 시작
```

### 서브에이전트로 컨텍스트 격리

탐색 작업을 서브에이전트에 위임하면 메인 컨텍스트를 절약합니다:

```
> 서브에이전트로 이 모듈을 조사해줘
```

서브에이전트의 결과만 요약되어 메인 세션에 반환됩니다.

---

## 모델 선택 전략

| 작업 | 권장 모델 | 이유 |
|------|----------|------|
| 코드 탐색, 간단한 질문 | **Haiku** | 빠르고 저렴 |
| 일반 코딩, 버그 수정 | **Sonnet** | 비용/성능 균형 |
| 복잡한 리팩토링, 아키텍처 | **Opus** | 깊은 추론 필요 |
| 서브에이전트 (탐색) | **Haiku** | 대량 탐색에 적합 |

### 동적 모델 전환

```
# 탐색 (Haiku)
> Option+P → Haiku 선택
> 프로젝트 구조를 분석해줘

# 구현 (Opus)
> Option+P → Opus 선택
> 복잡한 알고리즘을 구현해줘
```

---

## 사고 토큰 관리

Extended Thinking (적응형 추론)은 추가 토큰을 소비합니다:

```bash
# 사고 토큰 예산 줄이기
export MAX_THINKING_TOKENS=8000  # 기본값 31,999

# 노력 수준 낮추기
export CLAUDE_CODE_EFFORT_LEVEL=medium  # low, medium, high
```

간단한 작업에는 사고 토큰을 줄여 비용을 절약합니다.

---

## 예산 제어

### CLI 플래그

```bash
# 비용 한도 ($0.50)
claude -p "분석해줘" --max-budget-usd 0.50

# 턴 수 제한
claude -p "수정해줘" --max-turns 5
```

### CI/CD 환경

```yaml
- run: |
    claude -p "리뷰해줘" \
      --max-budget-usd 1.00 \
      --max-turns 10 \
      --model haiku
```

---

## Hooks와 Skills로 토큰 절약

### 자동 포매팅 훅

Claude가 포매팅에 토큰을 쓰는 대신, 훅으로 자동 처리:

```json
{
  "hooks": [
    {
      "event": "PostToolUse",
      "matcher": "Write|Edit",
      "type": "command",
      "command": "npx prettier --write $FILE"
    }
  ]
}
```

### 스킬의 컨텍스트 절약

스킬은 기본적으로 **온디맨드 로딩**입니다. description(짧은 설명)만 컨텍스트에 포함되고, SKILL.md 전체 내용은 실제 호출 시에만 로드됩니다.

`disable-model-invocation: true`를 설정하면 description조차 컨텍스트에서 제외되어 **더 적극적으로 절약**할 수 있습니다:

```yaml
---
disable-model-invocation: true
---
```

| 설정 | description | 전체 내용 | 호출 방식 |
|------|:-----------:|:---------:|-----------|
| 기본값 | 항상 로드 | 호출 시 로드 | Claude 자동 + 사용자 `/name` |
| `disable-model-invocation: true` | 로드 안 함 | 호출 시 로드 | 사용자 `/name`만 |

스킬이 많은 프로젝트에서는 자주 사용하지 않는 스킬에 이 설정을 적용하면 컨텍스트를 효과적으로 확보할 수 있습니다.

---

## MCP 오버헤드 줄이기

MCP 도구가 많으면 도구 설명이 컨텍스트를 차지합니다:

- 사용하지 않는 MCP 서버 비활성화 (`/mcp`)
- Tool Search가 10% 초과 시 자동 활성화되므로 과도한 서버 설정 주의
- 필요한 서버만 프로젝트별로 설정

---

## 비용 최적화 체크리스트

- [ ] CLAUDE.md를 500줄 이내로 유지
- [ ] 작업 간 `/clear` 또는 `/compact` 사용
- [ ] 탐색 작업에 서브에이전트 활용
- [ ] 간단한 작업에 Haiku 사용
- [ ] CI에서 `--max-budget-usd` 설정
- [ ] 사용하지 않는 MCP 서버 비활성화
- [ ] 세션을 이어가기 (`--continue`) 활용
- [ ] 포매팅은 훅으로 자동화

---

## 요약

| 전략 | 절감 효과 |
|------|----------|
| **프롬프트 캐싱** | 최대 90% 입력 비용 절감 |
| **모델 선택** | Haiku는 Opus 대비 80% 저렴 |
| **컨텍스트 관리** | `/compact`, `/clear`, 서브에이전트 |
| **사고 토큰** | 노력 수준 조절로 출력 토큰 절약 |
| **예산 제어** | `--max-budget-usd`, `--max-turns` |
| **자동화** | 훅으로 포매팅 등 반복 작업 대체 |

---

## 다음 챕터

[32장: 보안과 베스트 프랙티스](04-security-best-practices.md)에서 Claude Code를 안전하게 사용하기 위한 가이드를 배웁니다.
