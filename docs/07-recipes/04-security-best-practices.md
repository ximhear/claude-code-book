<!-- last_updated: 2026-02-11 -->

# 33. 보안과 베스트 프랙티스

> Claude Code를 안전하게 사용하기 위한 보안 가이드를 다룹니다.

---

## 권한 모드 선택 가이드

| 모드 | 안전성 | 속도 | 권장 상황 |
|------|:------:|:----:|----------|
| **Plan** | 최고 | 느림 | 탐색, 리뷰, 신뢰하지 않는 코드 |
| **Default** | 높음 | 중간 | 일반 개발 |
| **Accept Edits** | 중간 | 빠름 | 신뢰하는 프로젝트 |
| **dontAsk** | 낮음 | 가장 빠름 | 자동화 파이프라인 |
| **bypassPermissions** | 없음 | 가장 빠름 | 격리된 컨테이너만 |

### 원칙: 최소 권한

필요한 최소한의 권한만 부여합니다. 탐색은 Plan 모드, 코딩은 Default 모드, 신뢰하는 반복 작업은 Accept Edits.

---

## 민감한 파일 보호

### 권한 규칙으로 차단

```json
{
  "permissions": {
    "deny": [
      "Read(.env)",
      "Read(.env.*)",
      "Read(secrets/**)",
      "Read(~/.aws/**)",
      "Read(~/.ssh/**)",
      "Edit(.env*)",
      "Edit(secrets/**)"
    ]
  }
}
```

### .claudeignore

`.gitignore`와 유사한 문법으로 Claude의 파일 접근을 차단합니다:

```
# .claudeignore
.env
.env.*
secrets/
credentials.json
*.pem
*.key
```

---

## 샌드박싱

### OS 수준 격리

Claude Code는 OS 수준 샌드박싱을 지원합니다:

- **Linux**: bubblewrap으로 파일시스템 격리
- **macOS**: seatbelt 프로파일

```json
{
  "sandbox": { "enabled": true }
}
```

### 네트워크 격리

- 승인된 도메인만 접근 허용
- 프록시를 통한 네트워크 트래픽 제어
- 클라우드 세션은 기본적으로 네트워크 제한

### 심층 방어 (Defense in Depth)

```
권한 규칙 (Claude의 도구 호출 제어)
    ↓
샌드박싱 (OS 수준 실행 환경 격리)
    ↓
네트워크 격리 (외부 통신 제한)
```

세 계층을 함께 사용하는 것이 가장 안전합니다.

---

## 프롬프트 인젝션 방지

### 위험 시나리오

외부 소스에서 가져온 콘텐츠 (웹 페이지, 파일, MCP 도구 결과)에 악의적인 지시가 포함될 수 있습니다.

### 방어 메커니즘

| 방어 | 설명 |
|------|------|
| **권한 시스템** | 도구 실행에 사용자 승인 필요 |
| **컨텍스트 격리** | 웹 콘텐츠를 별도 컨텍스트에서 처리 |
| **명령어 감지** | 의심스러운 Bash 명령어 감지 |
| **쓰기 제한** | 세션 폴더와 하위에만 쓰기 가능 |
| **PostToolUse 훅** | 인젝션 시도 실시간 감지 |

### 실천 가이드

- 신뢰하지 않는 저장소를 처음 열 때 Plan 모드 사용
- MCP 서버 추가 시 신뢰성 확인
- WebFetch 결과를 무조건 신뢰하지 않기
- 도구 실행 승인 프롬프트를 주의 깊게 확인

---

## MCP 서버 보안

### 서버 신뢰 확인

- 공식 또는 검증된 MCP 서버만 사용
- 오픈 소스 서버의 코드를 리뷰
- `strictKnownMarketplaces`로 승인된 소스만 허용

### 권한 제한

```json
{
  "permissions": {
    "allow": ["mcp__github__get_issue"],
    "deny": ["mcp__github__delete_*"]
  }
}
```

읽기 전용 작업만 허용하고 위험한 작업은 차단합니다.

---

## CI/CD 보안

### API 키 관리

- 환경 변수나 시크릿 매니저 사용
- 코드에 API 키 하드코딩 금지
- 키 로테이션 정책 수립

### 실행 환경

```bash
# 읽기 전용 모드
export CLAUDE_CODE_PERMISSION_MODE=plan

# 비용 한도
claude -p "리뷰" --max-budget-usd 1.00

# 세션 저장 안 함
claude -p "분석" --no-session-persistence
```

### 위험 완화

- 프로덕션 환경에 직접 접근 차단
- `deny` 규칙으로 위험한 명령어 차단
- 타임아웃 설정으로 무한 실행 방지

---

## 감사 로깅

### 트랜스크립트 추적

모든 Claude 세션의 도구 사용, 명령어 실행, 파일 변경이 기록됩니다.

### OpenTelemetry

```json
{
  "env": {
    "CLAUDE_CODE_ENABLE_TELEMETRY": "1"
  }
}
```

- 도구 호출 추적
- 비용 모니터링
- 이상 행동 감지

---

## 데이터 프라이버시

### 데이터 전송 범위

- 대화 내용과 도구 결과가 Anthropic API로 전송
- 클라우드 프로바이더 사용 시 해당 프로바이더로 전송
- 로컬 파일은 도구 호출 시에만 읽힘

### 데이터 보존과 삭제

- **세션 데이터**: 로컬에 저장 (`~/.claude/sessions/`), 30일 후 자동 삭제
- **API 전송 데이터**: Anthropic의 [데이터 보존 정책](https://www.anthropic.com/privacy)에 따름
- **클라우드 프로바이더**: Bedrock/Vertex/Foundry 사용 시 해당 프로바이더의 보존 정책 적용
- **GDPR/개인정보**: 개인 식별 정보가 포함된 파일은 `deny` 규칙으로 원천 차단
- **엔터프라이즈**: Admin Console에서 트랜스크립트 보존 기간 설정 가능 (기본 7-14일)

### 프라이버시 최적화

- 민감한 데이터가 포함된 파일을 `deny` 규칙으로 차단
- 클라우드 프로바이더를 통해 데이터 레지던시 보장
- `.claudeignore`로 파일 접근 제한
- 개인정보가 포함된 테스트 데이터 대신 가명화된 데이터 사용

---

## 보안 체크리스트

- [ ] 적절한 권한 모드 설정
- [ ] `.env`, 비밀 키 파일에 `deny` 규칙 적용
- [ ] 샌드박싱 활성화
- [ ] MCP 서버 신뢰성 확인
- [ ] CI/CD에서 `--max-budget-usd` 설정
- [ ] 프로덕션 환경 직접 접근 차단
- [ ] API 키를 시크릿 매니저로 관리
- [ ] 감사 로깅 활성화
- [ ] 팀원에게 보안 가이드 공유

---

## 요약

| 주제 | 핵심 포인트 |
|------|------------|
| **권한 모드** | 최소 권한 원칙, 작업에 맞는 모드 선택 |
| **파일 보호** | `deny` 규칙, `.claudeignore` |
| **샌드박싱** | OS 수준 격리 + 네트워크 격리 |
| **프롬프트 인젝션** | 권한 시스템, 컨텍스트 격리, 승인 확인 |
| **MCP 보안** | 신뢰 확인, 권한 제한 |
| **CI/CD** | API 키 관리, 비용 한도, 읽기 전용 모드 |
| **감사** | 트랜스크립트, OpenTelemetry |
| **프라이버시** | 데이터 전송 범위 이해, 민감 데이터 차단 |

---

## 다음 챕터

[34장: 실전 사례 — Claude Code로 이 책을 만든 과정](05-real-world-case-study.md)에서 10,000줄 기술 서적을 만들며 사용한 실제 기법을 공개합니다.
